<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>白日放歌匹配器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            padding: 8px;
        }
        .password-error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #ff4444;
            font-size: 14px;
            font-weight: 500;
            background: white;
            padding: 10px 18px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: none;
        }
        .password-error button {
            margin-top: 8px;
            padding: 4px 12px;
            border: none;
            border-radius: 3px;
            background: #0066ff;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        .password-error button:hover {
            background: #0056d2;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            display: none;
        }
        .input-wrapper {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .quick-input {
            display: flex;
            flex-direction: column;
            gap: 2px;
            width: 180px;
        }
        .input-header {
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            padding: 5px 0;
            border-radius: 4px 4px 0 0;
            color: white;
        }
        .host-header {
            background-color: #0066ff;
        }
        .guest-header {
            background-color: #ff3333;
        }
        .num-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            border-radius: 0 0 4px 4px;
            padding: 5px;
            height: calc(6 * 35px + 10px);
        }
        .num-item {
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            height: 35px;
            line-height: 35px;
            border-radius: 3px;
        }
        .host-grid .num-item {
            background-color: #0066ff;
            color: white;
        }
        .guest-grid .num-item {
            background-color: #ff3333;
            color: white;
        }
        .num-item.active {
            opacity: 0.8;
            box-shadow: 0 0 3px rgba(0,0,0,0.2);
        }
        .host-grid .num-item:hover, .guest-grid .num-item:hover {
            opacity: 0.9;
        }
        .host-grid .num-item:hover {
            background-color: #0056d2;
        }
        .guest-grid .num-item:hover {
            background-color: #e62e2e;
        }
        .control-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
        }
        .arrow-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .arrow-btn {
            border: none;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .arrow-sm {
            width: 32px;
            height: 32px;
            font-size: 14px;
            background-color: #888;
        }
        .arrow-lg {
            width: 38px;
            height: 38px;
            font-size: 16px;
            font-weight: 900;
            background-color: #555;
        }
        .reset-btn {
            width: 38px;
            height: 38px;
            border: none;
            border-radius: 50%;
            background-color: #0066ff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .arrow-btn:hover, .reset-btn:hover {
            opacity: 0.8;
        }
        .match-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .section {
            padding: 8px;
            border-radius: 4px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section-header, .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
            padding-bottom: 3px;
            border-bottom: 1px solid #eee;
        }
        .section-header h3, .section-title h3, .history-section h3 {
            font-size: 12px;
            color: #333;
            font-weight: normal;
            margin: 0;
        }
        .title-text {
            font-size: 10px;
            color: #1d1d1f;
            opacity: 0.3;
            font-weight: 400;
            line-height: 1;
        }
        .display-section {
            overflow-y: auto;
            font-size: 13px;
            scroll-behavior: smooth;
            padding: 2px 0;
        }
        #matchedContainer {
            max-height: 100px;
            padding: 2px 0;
        }
        .same-disk-item, .unmatched-item, .matched-item {
            display: inline-block;
            background: #f9f9f9;
            border-radius: 2px;
            white-space: nowrap;
        }
        .same-disk-item, .unmatched-item {
            margin: 0 3px 3px 0;
            padding: 3px 6px;
            font-size: 13px;
        }
        #matchedContainer .matched-item {
            font-size: 10px;
            padding: 2px 3px;
            margin: 0 1px 2px 0;
        }
        .host-value, .guest-value {
            font-weight: 600;
            font-size: 14px;
        }
        #matchedContainer .host-value, #matchedContainer .guest-value {
            font-size: 11px;
            font-weight: 500;
        }
        .host-value {
            color: #0066ff;
        }
        .guest-value {
            color: #ff3333;
        }
        .unmatched-wrap {
            display: flex;
            gap: 6px;
        }
        .unmatched-group {
            flex: 1;
        }
        .unmatched-group h4 {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }
        .empty-tip {
            color: #999;
            font-size: 12px;
            font-style: italic;
            padding: 3px 0;
        }
        .history-section {
            padding: 8px;
            border-radius: 4px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .history-list {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 4px;
            max-height: 80px;
            overflow-y: auto;
            font-size: 13px;
            scroll-behavior: smooth;
            padding: 2px 0;
        }
        .history-item {
            padding: 4px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
        }
        .history-item.host-item {
            background: rgba(0,102,255,0.1);
            color: #0066ff;
        }
        .history-item.guest-item {
            background: rgba(255,51,51,0.1);
            color: #ff3333;
        }
        .history-item:hover {
            opacity: 0.9;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .footer-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 0;
        }
        .clear-btn {
            width: 72px;
            height: 24px;
            border: none;
            border-radius: 2px;
            background-color: #34c759;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clear-btn:hover {
            background-color: #28a745;
        }
        .num-big {
            font-size: 16px;
            font-weight: bold;
        }
        .delete-tip {
            font-size: 10px;
            color: #888;
            margin-left: 8px;
            font-weight: normal;
        }
        ::-webkit-scrollbar {
            width: 3px;
            height: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 1.5px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 1.5px;
        }
        .admin-section {
            max-width: 500px;
            margin: 15px auto 0;
            padding: 10px;
            border-radius: 4px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: none;
        }
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .admin-header h3 {
            font-size: 13px;
            color: #333;
            margin: 0;
        }
        .admin-form {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .admin-input {
            flex: 1;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
            outline: none;
        }
        .admin-input:focus {
            border-color: #0066ff;
        }
        .save-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 3px;
            background-color: #0066ff;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .save-btn:hover {
            background-color: #0056d2;
        }
        /* 洞功能样式 */
        .hole-container {
            display: flex;
            align-items: center;
            gap: 2px;
            font-size: 10px;
            flex-wrap: nowrap;
        }
        .hole-label {
            color: #333;
            font-weight: 500;
            margin: 0;
        }
        .hole-item {
            display: inline-block;
            margin: 0 1px;
            vertical-align: middle;
        }
        .hole-number {
            font-size: 11px;
            font-weight: 600;
            vertical-align: middle;
        }
        .hole-count {
            font-size: 7px;
            color: #000;
            font-weight: 500;
            vertical-align: super;
            margin-left: 1px;
        }
        .hole-blue { color: #0066ff; }
        .hole-green { color: #34c759; }
        .hole-red { color: #ff3333; }
        .hole-empty-tip {
            color: #999;
            font-size: 9px;
            font-style: italic;
        }
        /* 数字超25个提示样式 */
        .hole-overflow-tip {
            color: #ff3333;
            font-size: 10px;
            font-weight: bold;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="password-error" id="passwordError">
        提示：请输入正确密码。<br>
        <button onclick="checkPassword()">重新输入</button>
    </div>
    <div class="container" id="appContainer">
        <div class="input-wrapper">
            <div class="quick-input">
                <div class="input-header host-header">主队</div>
                <div class="num-grid host-grid" id="hostGrid"></div>
            </div>
            <div class="quick-input">
                <div class="input-header guest-header">客队</div>
                <div class="num-grid guest-grid" id="guestGrid"></div>
            </div>
        </div>
        <div class="control-wrapper">
            <div class="arrow-group">
                <button class="arrow-btn arrow-sm" onclick="scrollNums('host', -6)">↑</button>
                <button class="arrow-btn arrow-lg" onclick="scrollNums('host', -15)">↑</button>
                <button class="arrow-btn arrow-lg" onclick="scrollNums('host', 15)">↓</button>
                <button class="arrow-btn arrow-sm" onclick="scrollNums('host', 6)">↓</button>
            </div>
            <button class="reset-btn" onclick="resetNumPosition()">⟲</button>
            <div class="arrow-group">
                <button class="arrow-btn arrow-sm" onclick="scrollNums('guest', -6)">↑</button>
                <button class="arrow-btn arrow-lg" onclick="scrollNums('guest', -15)">↑</button>
                <button class="arrow-btn arrow-lg" onclick="scrollNums('guest', 15)">↓</button>
                <button class="arrow-btn arrow-sm" onclick="scrollNums('guest', 6)">↓</button>
            </div>
        </div>
        <div class="match-section">
            <div class="section">
                <div class="section-header">
                    <h3 id="sameDiskCountTitle">同盘 <span class="num-big">0</span> 组</h3>
                    <button class="clear-btn" onclick="clearAll()">清除所有</button>
                </div>
                <div class="display-section" id="sameDiskContainer">
                    <div class="empty-tip">暂无同盘匹配</div>
                </div>
            </div>
            <div class="section">
                <div class="section-title">
                    <h3 id="matchCountTitle">富贵洞 <span class="num-big">0</span> 组</h3>
                    <div id="holeContainer" class="hole-container">
                        <span class="hole-label">洞：</span>
                        <span class="hole-empty-tip">暂无数据</span>
                    </div>
                </div>
                <div class="display-section" id="matchedContainer">
                    <div class="empty-tip">暂无富贵洞匹配</div>
                </div>
            </div>
            <div class="section">
                <div class="section-title">
                    <h3 id="unmatchCountTitle">必胜边（主队边<span class="num-big">0</span> 客队边<span class="num-big">0</span>）</h3>
                    <span class="title-text">白日放歌匹配器</span>
                </div>
                <div class="unmatched-wrap">
                    <div class="unmatched-group">
                        <h4>主队（蓝）</h4>
                        <div id="unmatchedHost" class="display-section">
                            <div class="empty-tip">暂无</div>
                        </div>
                    </div>
                    <div class="unmatched-group">
                        <h4>客队（红）</h4>
                        <div id="unmatchedGuest" class="display-section">
                            <div class="empty-tip">暂无</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="history-section">
            <h3 id="inputCountTitle">已注入 <span class="num-big">0</span>（主<span class="num-big">0</span> 客<span class="num-big">0</span>）<span class="delete-tip">【点击删除】</span></h3>
            <div class="history-list" id="historyList">
                <div class="empty-tip">暂无</div>
            </div>
        </div>
        <div class="footer-wrapper"></div>
    </div>
    <div class="admin-section" id="adminSection">
        <div class="admin-header">
            <h3>系统管理（管理员权限）</h3>
        </div>
        <div class="admin-form">
            <input type="text" class="admin-input" id="newAccessPassword" placeholder="请输入新的普通访问密码（当前：168168）">
            <button class="save-btn" onclick="saveNewAccessPassword()">保存修改</button>
        </div>
    </div>
    <script>
        const ADMIN_PASSWORD = "18181818",
              INIT_ACCESS_PASSWORD = "168168",
              MIN_NUM = -100.5,
              MAX_NUM = 100.5,
              NUM_COUNT = 18,
              ACTIVE_INDEX = 8;
        let currentHostMiddle = 0.5,
            inputOrder = [],
            currentAccessPassword = localStorage.getItem('daytimeMatchAccessPwd') || INIT_ACCESS_PASSWORD,
            isAdmin = false;
        window.onload = checkPassword;
        function checkPassword() {
            const inputPwd = prompt("请输入正确密码：", "");
            if (inputPwd === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById("appContainer").style.display = "flex";
                document.getElementById("adminSection").style.display = "block";
                document.getElementById("passwordError").style.display = "none";
                initApp();
                alert("管理员登录成功，已显示系统管理界面！");
            } else if (inputPwd === currentAccessPassword) {
                isAdmin = false;
                document.getElementById("appContainer").style.display = "flex";
                document.getElementById("adminSection").style.display = "none";
                document.getElementById("passwordError").style.display = "none";
                initApp();
            } else {
                isAdmin = false;
                document.getElementById("appContainer").style.display = "none";
                document.getElementById("adminSection").style.display = "none";
                document.getElementById("passwordError").style.display = "block";
            }
        }
        function saveNewAccessPassword() {
            if (!isAdmin) {
                alert("无管理员权限，无法修改访问密码！");
                return;
            }
            const newPwd = document.getElementById("newAccessPassword").value.trim();
            if (!newPwd) {
                alert("新密码不能为空，请输入有效密码！");
                return;
            }
            if (newPwd.length < 6) {
                alert("建议密码长度不小于6位，提升安全性！");
            }
            currentAccessPassword = newPwd;
            localStorage.setItem('daytimeMatchAccessPwd', newPwd);
            document.getElementById("newAccessPassword").placeholder = `请输入新的普通访问密码（当前：${newPwd}）`;
            document.getElementById("newAccessPassword").value = "";
            alert(`普通访问密码修改成功！新密码为：${currentAccessPassword}\n下次普通用户登录需使用新密码`);
        }
        function initApp() {
            updateGrids();
            updateInputCount();
            if (isAdmin) {
                document.getElementById("newAccessPassword").placeholder = `请输入新的普通访问密码（当前：${currentAccessPassword}）`;
            }
        }
        function updateGrids() {
            const hostDom = document.getElementById('hostGrid'),
                  guestDom = document.getElementById('guestGrid');
            hostDom.innerHTML = '';
            guestDom.innerHTML = '';
            const hostStart = currentHostMiddle - 8,
                  hostNums = [];
            for (let i = 0; i < NUM_COUNT; i++) hostNums.push(hostStart + i);
            hostNums.forEach((num, idx) => {
                hostDom.appendChild(createNumItem(num, 'host', idx === ACTIVE_INDEX));
                guestDom.appendChild(createNumItem(-num, 'guest', idx === ACTIVE_INDEX));
            });
        }
        function createNumItem(num, type, isActive) {
            const item = document.createElement('div');
            let displayText, signNum;
            if (num === -0.5) {
                displayText = '-0';
                signNum = 0;
            } else if (num === 0.5) {
                displayText = '+0';
                signNum = 0;
            } else {
                const displayInt = num > 0 ? Math.floor(num) : Math.ceil(num);
                displayText = displayInt >= 0 ? `+${displayInt}` : `${displayInt}`;
                signNum = Math.abs(displayInt);
            }
            item.className = `num-item ${isActive ? 'active' : ''}`;
            item.textContent = displayText;
            item.onclick = () => {
                inputOrder.push({ 
                    id: Date.now() + Math.random(),
                    type, value: num, display: displayText,
                    isNegative: num < 0, signNum
                });
                updateHistory();
                updateInputCount();
                rematch();
            };
            return item;
        }
        window.scrollNums = function(type, step) {
            let newHostMiddle = currentHostMiddle;
            if (type === 'guest') newHostMiddle = -(-currentHostMiddle + step);
            else newHostMiddle += step;
            if (newHostMiddle > MAX_NUM) newHostMiddle = MIN_NUM;
            if (newHostMiddle < MIN_NUM) newHostMiddle = MAX_NUM;
            currentHostMiddle = newHostMiddle;
            updateGrids();
        };
        window.resetNumPosition = function() {
            currentHostMiddle = 0.5;
            updateGrids();
        };
        function updateHistory() {
            const historyDom = document.getElementById('historyList');
            historyDom.innerHTML = '';
            if (inputOrder.length === 0) {
                historyDom.innerHTML = '<div class="empty-tip">暂无</div>';
                return;
            }
            inputOrder.forEach((item, idx) => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${item.type}-item`;
                historyItem.textContent = item.display;
                historyItem.onclick = () => {
                    inputOrder.splice(idx, 1);
                    updateHistory();
                    updateInputCount();
                    rematch();
                };
                historyDom.appendChild(historyItem);
            });
            historyDom.scrollTop = historyDom.scrollHeight;
        }
        function rematch() {
            const allHosts = inputOrder.filter(i => i.type === 'host'),
                  allGuests = inputOrder.filter(i => i.type === 'guest');
            const sameDiskPairs = [], normalPairs = [];
            const usedGuestIds = new Set();
            const sortedHosts = [...allHosts].sort((a, b) => a.value - b.value),
                  sortedGuests = [...allGuests].sort((a, b) => a.value - b.value);
            
            sortedHosts.forEach(host => {
                for (const guest of sortedGuests) {
                    if (usedGuestIds.has(guest.id) || (host.isNegative && guest.isNegative)) continue;
                    const isOppositeSign = host.isNegative !== guest.isNegative,
                          isSameSignNum = host.signNum === guest.signNum;
                    const negativeSignNum = isOppositeSign ? (host.isNegative ? host.signNum : guest.signNum) : 0,
                          positiveSignNum = isOppositeSign ? (host.isNegative ? guest.signNum : host.signNum) : host.signNum;
                    
                    if (isOppositeSign && isSameSignNum) {
                        sameDiskPairs.push({ hostId: host.id, guestId: guest.id });
                        usedGuestIds.add(guest.id);
                        break;
                    } else if ((isOppositeSign && !isSameSignNum && positiveSignNum > negativeSignNum) || (!isOppositeSign && !host.isNegative)) {
                        normalPairs.push({ hostId: host.id, guestId: guest.id });
                        usedGuestIds.add(guest.id);
                        break;
                    }
                }
            });

            const sortedNormalPairs = [...normalPairs].sort((a, b) => {
                const hostA = inputOrder.find(i => i.id === a.hostId);
                const hostB = inputOrder.find(i => i.id === b.hostId);
                return hostB.value - hostA.value;
            });

            const unmatchedHostIds = [...sameDiskPairs.map(p => p.hostId), ...normalPairs.map(p => p.hostId)];
            const unmatchedHosts = allHosts.filter(h => !unmatchedHostIds.includes(h.id)).sort((a, b) => b.value - a.value);
            const unmatchedGuests = allGuests.filter(g => !usedGuestIds.has(g.id)).sort((a, b) => b.value - a.value);

            const holeData = calculateHoleData(sortedNormalPairs);

            updateMatchUnmatchCount(sameDiskPairs.length, normalPairs.length, unmatchedHosts.length, unmatchedGuests.length);
            updateMatchDisplay(sameDiskPairs, 'sameDiskContainer', 'same-disk-item');
            updateMatchDisplay(sortedNormalPairs, 'matchedContainer', 'matched-item');
            updateUnmatchDisplay(unmatchedHosts, unmatchedGuests);
            updateHoleDisplay(holeData);
        }

        // 核心新规则：严格按用户示例推导（正正/符号相反逻辑）
        function calculateHoleData(normalPairs) {
            let holeNumbers = [];
            if (normalPairs.length === 0) return holeNumbers;

            normalPairs.forEach(pair => {
                const host = inputOrder.find(i => i.id === pair.hostId);
                const guest = inputOrder.find(i => i.id === pair.guestId);
                const hostAbs = host.signNum; // 主队绝对值
                const guestAbs = guest.signNum; // 客队绝对值

                // 场景1：正正组合（主队+，客队+）→ 蓝（客队Abs→1）→ 绿0 → 红（1→主队Abs）
                if (!host.isNegative && !guest.isNegative) {
                    // 蓝色：客队绝对值递减到1（如客队3→3、2、1；客队2→2、1）
                    for (let i = guestAbs; i >= 1; i--) {
                        holeNumbers.push({ value: i, color: 'blue' });
                    }
                    // 绿色：固定0
                    holeNumbers.push({ value: 0, color: 'green' });
                    // 红色：1递增到主队绝对值（如主队2→1、2；主队4→1、2、3、4）
                    for (let i = 1; i <= hostAbs; i++) {
                        holeNumbers.push({ value: i, color: 'red' });
                    }
                }
                // 场景2：符号相反-主队负、客队正（-x+y）→ 蓝（y→x+1，从大到小）
                else if (host.isNegative && !guest.isNegative) {
                    const start = guestAbs; // 客队绝对值（y）
                    const end = hostAbs + 1; // 主队绝对值+1（x+1）
                    // 递减循环（如-2+3→3→3；-2+4→4→3）
                    for (let i = start; i >= end; i--) {
                        holeNumbers.push({ value: i, color: 'blue' });
                    }
                }
                // 场景3：符号相反-主队正、客队负（+x-y）→ 红（y+1→x，从小到大）
                else if (!host.isNegative && guest.isNegative) {
                    const start = guestAbs + 1; // 客队绝对值+1（y+1）
                    const end = hostAbs; // 主队绝对值（x）
                    // 递增循环（如+3-2→3→3；+4-2→3→4）
                    for (let i = start; i <= end; i++) {
                        holeNumbers.push({ value: i, color: 'red' });
                    }
                }
            });

            // 统计重复次数（去重，相同颜色+数字合并）
            const countMap = {};
            holeNumbers.forEach(item => {
                const key = `${item.color}-${item.value}`;
                countMap[key] = (countMap[key] || 0) + 1;
            });

            // 排序规则：蓝（从大到小）→ 绿（固定0）→ 红（从小到大）
            let result = Object.keys(countMap).map(key => {
                const [color, value] = key.split('-');
                return {
                    color,
                    value: parseInt(value),
                    count: countMap[key]
                };
            }).sort((a, b) => {
                // 颜色优先级：蓝1→绿2→红3
                const colorOrder = { 'blue': 1, 'green': 2, 'red': 3 };
                if (a.color !== b.color) {
                    return colorOrder[a.color] - colorOrder[b.color];
                }
                // 同色排序：蓝色降序，红色升序
                if (a.color === 'blue') {
                    return b.value - a.value;
                } else if (a.color === 'red') {
                    return a.value - b.value;
                } else {
                    return 0; // 绿色仅0，无需排序
                }
            });

            return result;
        }

        // 调整：特殊提示阈值改为25个不同数字
        function updateHoleDisplay(holeData) {
            const container = document.getElementById('holeContainer');
            container.innerHTML = '<span class="hole-label">洞：</span>';
            
            // 规则：不同数字（去重后）≥25个，显示特殊提示
            if (holeData.length >= 25) {
                container.innerHTML += '<span class="hole-overflow-tip">这么多，庄家输麻了，都是你的，都是你的！！！</span>';
                return;
            }

            // 数字<25个，正常显示
            if (holeData.length === 0) {
                container.innerHTML += '<span class="hole-empty-tip">暂无数据</span>';
                return;
            }

            holeData.forEach(item => {
                const holeItem = document.createElement('span');
                holeItem.className = 'hole-item';
                
                const numberSpan = document.createElement('span');
                numberSpan.className = `hole-number hole-${item.color}`;
                numberSpan.textContent = item.value;
                
                holeItem.appendChild(numberSpan);
                if (item.count > 1) {
                    const countSpan = document.createElement('span');
                    countSpan.className = 'hole-count';
                    countSpan.textContent = item.count;
                    holeItem.appendChild(countSpan);
                }
                container.appendChild(holeItem);
            });
        }

        function updateMatchDisplay(pairs, containerId, itemClass) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            if (pairs.length === 0) {
                container.innerHTML = `<div class="empty-tip">暂无${containerId === 'sameDiskContainer' ? '同盘' : '富贵洞'}匹配</div>`;
                return;
            }
            pairs.forEach(pair => {
                const host = inputOrder.find(i => i.id === pair.hostId),
                      guest = inputOrder.find(i => i.id === pair.guestId);
                const item = document.createElement('div');
                item.innerHTML = `【<span class="host-value">${host.display}</span>↔<span class="guest-value">${guest.display}</span>】`;
                item.className = itemClass;
                container.appendChild(item);
            });
            container.scrollTop = container.scrollHeight;
        }
        function updateUnmatchDisplay(unmatchedHosts, unmatchedGuests) {
            const [unHostDom, unGuestDom] = [
                document.getElementById('unmatchedHost'),
                document.getElementById('unmatchedGuest')
            ];
            unHostDom.innerHTML = '';
            unGuestDom.innerHTML = '';
            if (unmatchedHosts.length === 0) unHostDom.innerHTML = '<div class="empty-tip">暂无</div>';
            else unmatchedHosts.forEach(host => {
                const item = document.createElement('div');
                item.className = 'unmatched-item';
                item.innerHTML = `<span class="host-value">${host.display}</span>`;
                unHostDom.appendChild(item);
            });
            if (unmatchedGuests.length === 0) unGuestDom.innerHTML = '<div class="empty-tip">暂无</div>';
            else unmatchedGuests.forEach(guest => {
                const item = document.createElement('div');
                item.className = 'unmatched-item';
                item.innerHTML = `<span class="guest-value">${guest.display}</span>`;
                unGuestDom.appendChild(item);
            });
            unHostDom.scrollTop = unHostDom.scrollHeight;
            unGuestDom.scrollTop = unGuestDom.scrollHeight;
        }
        function updateMatchUnmatchCount(sameDiskCount, normalCount, unHostCount, unGuestCount) {
            document.getElementById('sameDiskCountTitle').innerHTML = `同盘 <span class="num-big">${sameDiskCount}</span> 组`;
            document.getElementById('matchCountTitle').innerHTML = `富贵洞 <span class="num-big">${normalCount}</span> 组`;
            document.getElementById('unmatchCountTitle').innerHTML = `必胜边（主队边<span class="num-big">${unHostCount}</span> 客队边<span class="num-big">${unGuestCount}</span>）`;
        }
        function updateInputCount() {
            const total = inputOrder.length,
                  hostCount = inputOrder.filter(i => i.type === 'host').length,
                  guestCount = inputOrder.filter(i => i.type === 'guest').length;
            document.getElementById('inputCountTitle').innerHTML = 
                `已注入 <span class="num-big">${total}</span>（主<span class="num-big">${hostCount}</span> 客<span class="num-big">${guestCount}</span>）<span class="delete-tip">【点击删除】</span>`;
        }
        window.clearAll = function() {
            currentHostMiddle = 0.5;
            inputOrder = [];
            updateGrids();
            updateHistory();
            updateInputCount();
            updateMatchUnmatchCount(0, 0, 0, 0);
            updateMatchDisplay([], 'sameDiskContainer', 'same-disk-item');
            updateMatchDisplay([], 'matchedContainer', 'matched-item');
            updateUnmatchDisplay([], []);
            updateHoleDisplay([]);
        };
    </script>
</body>
</html>
