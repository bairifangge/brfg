<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁôΩÊó•ÊîæÊ≠åÂåπÈÖçÂô®</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Arial Rounded MT Bold", "Microsoft YaHei", sans-serif;
            transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .container-outer {
            max-width: 520px;
            margin: 8px auto;
            padding: 6px;
            border: 3px solid;
            border-image: linear-gradient(135deg, #0066ff 0%, #ff3333 100%) 1;
            border-radius: 14px;
            background: #f2f7f3;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        body {
            background: linear-gradient(120deg, #f0f4f8 0%, #e6edf5 100%);
            background-attachment: fixed;
            padding-bottom: 10px;
        }
        .pwd-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .pwd-modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            width: 280px;
            text-align: center;
        }
        .pwd-modal-content h3 {
            font-size: 14px;
            color: #333;
            margin-bottom: 12px;
        }
        .pwd-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 12px;
            font-size: 13px;
        }
        .pwd-btn-group {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .pwd-btn {
            padding: 6px 16px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        .pwd-confirm {
            background: #0066ff;
            color: #fff;
        }
        .pwd-cancel {
            background: #f5f5f5;
            color: #666;
        }
        .password-error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fafafa;
            padding: 10px 16px;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.12), 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #ffebee;
            color: #ff4444;
            font-size: 13px;
            text-align: center;
            display: none;
            z-index: 100;
        }
        .password-error button {
            margin-top: 8px;
            padding: 5px 14px;
            border: none;
            border-radius: 4px;
            background: linear-gradient(135deg, #0066ff 0%, #0056d2 100%);
            color: #fff;
            font-size: 12px;
            cursor: pointer;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            display: none;
            flex-direction: column;
            gap: 5px;
            padding: 8px;
            background: #fafafa;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.07);
            height: auto !important;
            min-height: 100%;
        }
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #0066ff 0%, #ff3333 100%);
        }
        .input-wrapper {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 3px;
            position: relative;
            z-index: 10;
        }
        .quick-input {
            display: flex;
            flex-direction: column;
            width: 165px;
            border-radius: 8px;
            overflow: visible !important;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06);
            background: #fefefe;
            padding-bottom: 8px;
        }
        .input-header {
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            padding: 5px 0;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.12);
            position: relative;
        }
        .input-header::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        .host-header { background: linear-gradient(135deg, #0066ff 0%, #0056d2 100%); }
        .guest-header { background: linear-gradient(135deg, #ff3333 0%, #e62e2e 100%); }
        .num-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            padding: 4px 8px 10px;
            height: auto !important;
            min-height: calc(6 * 30px + 8px);
            background: linear-gradient(0deg, #f5f5f5 0%, #fafafa 100%);
            border-top: 1px solid #eee;
            overflow: visible !important;
        }
        .num-item {
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            height: 30px;
            line-height: 30px;
            border-radius: 4px;
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.9), 0 2px 3px rgba(0,0,0,0.06);
            color: #fff;
            position: relative;
            border: 1px solid transparent;
            overflow: visible !important;
            transform: none !important;
        }
        .num-item::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 60%;
            height: 30%;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            pointer-events: none;
        }
        .host-grid .num-item {
            background: linear-gradient(145deg, #0066ff 0%, #0056d2 100%);
            border-color: rgba(0,86,210,0.2);
        }
        .guest-grid .num-item {
            background: linear-gradient(145deg, #ff3333 0%, #e62e2e 100%);
            border-color: rgba(230,46,46,0.2);
        }
        .num-item.active {
            opacity: 0.92;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.18), 0 1px 1px rgba(0,0,0,0.05);
            transform: scale(0.98);
            border-color: rgba(0,0,0,0.1);
        }
        .control-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 0 !important;
            padding: 0;
            position: relative;
            z-index: 5;
        }
        .arrow-group { display: flex; gap: 6px; }
        .arrow-btn, .clear-btn, .reset-btn {
            border: none;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(52,199,89,0.2), inset 0 1px 1px rgba(255,255,255,0.3);
            position: relative;
        }
        .arrow-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: linear-gradient(145deg, #34c759 0%, #28a745 100%);
        }
        .reset-btn {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: linear-gradient(145deg, #2d9749 0%, #23783b 100%);
        }
        .clear-btn {
            width: 72px;
            height: 26px;
            border-radius: 4px;
            font-size: 12px;
            background: linear-gradient(145deg, #2d9749 0%, #23783b 100%);
        }
        .arrow-btn::after, .clear-btn::after, .reset-btn::after {
            content: "";
            position: absolute;
            top: 2px;
            background: rgba(255,255,255,0.25);
            pointer-events: none;
        }
        .arrow-btn::after, .clear-btn::after {
            right: 2px;
            width: 30%;
            height: 30%;
            border-radius: 50%;
        }
        .reset-btn::after {
            left: 3px;
            width: 40%;
            height: 40%;
            border-radius: 50%;
        }
        .match-section { display: flex; flex-direction: column; gap: 6px; margin-top: 3px; }
        .section {
            padding: 6px 8px;
            border-radius: 8px;
            background: #fefefe;
            box-shadow: 0 2px 7px rgba(0,0,0,0.06);
            border: 1px solid #f0f0f0;
            position: relative;
        }
        .section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #0066ff 0%, #ff3333 100%);
            opacity: 0.6;
        }
        .section-header, .section-title, .history-section h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            padding: 3px 6px;
            border-bottom: 1px solid #f0f0f0;
            border-radius: 4px;
            background: linear-gradient(180deg, #f9f9f9 0%, #f5f5f5 100%);
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.8), 0 1px 1px rgba(0,0,0,0.03);
            white-space: nowrap;
        }
        .section-header h3, .section-title h3, .history-section h3 {
            font-size: 12px;
            color: #333;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 1px 0;
            text-shadow: 0 1px 1px rgba(255,255,255,0.9);
            white-space: nowrap;
        }
        .section-header h3::before { content: "‚¶ø"; color: #0066ff; font-size: 12px; text-shadow: 0 1px 1px rgba(0,102,255,0.2); }
        #matchCount::before { content: "üí∞"; color: #ff3333; font-size: 12px; text-shadow: 0 1px 1px rgba(255,51,51,0.2); }
        #unmatchCount::before { content: "‚úì"; color: #34c759; font-size: 12px; text-shadow: 0 1px 1px rgba(52,199,89,0.2); }
        .history-section h3::before { content: "üìù"; color: #888; font-size: 12px; text-shadow: 0 1px 1px rgba(136,136,136,0.2); }
        .title-text {
            font-size: 11px;
            font-weight: 500;
            background: linear-gradient(145deg, #777 0%, #fff 50%, #777 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            opacity: 0.7;
            text-shadow: 0 0 1px rgba(0,0,0,0.2);
        }
        .display-section {
            overflow-y: auto;
            font-size: 12px;
            padding: 3px 2px;
            max-height: 90px;
            background: linear-gradient(0deg, #f9f9f9 0%, #fff 100%);
            border-radius: 4px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.02);
        }
        .same-disk-item, .matched-item, .unmatched-item {
            display: inline-block;
            margin: 0 2px 3px;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), inset 0 1px 1px rgba(255,255,255,0.7);
            min-width: calc(25% - 4px);
            text-align: center;
            background: linear-gradient(145deg, #f9f9f9 0%, #f0f0f0 100%);
        }
        .unmatched-group:first-child .unmatched-item { background: rgba(0,102,255,0.05); }
        .unmatched-group:last-child .unmatched-item { background: rgba(255,51,51,0.05); }
        .host-value, .guest-value {
            font-size: 11px !important;
            font-weight: 600 !important;
            display: inline-block;
        }
        .host-value { color: #0066ff; }
        .guest-value { color: #ff3333; }
        .unmatched-wrap { display: flex; justify-content: space-between; gap: 8px; }
        .unmatched-group { 
            width: calc(50% - 4px);
            position: relative;
        }
        .unmatched-group h4 {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(0,0,0,0.02);
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.5);
        }
        .unmatched-group h4::before {
            content: "";
            width: 4px;
            height: 4px;
            border-radius: 50%;
        }
        .unmatched-group:first-child h4::before { background: #0066ff; }
        .unmatched-group:last-child h4::before { background: #ff3333; }
        .empty-tip {
            color: #888;
            font-size: 12px;
            font-style: italic;
            padding: 8px 0;
            text-align: center;
            opacity: 0.8;
            background: rgba(0,0,0,0.01);
            border-radius: 4px;
            margin: 2px;
        }
        .overflow-tip {
            color: #ff3333;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            padding: 6px 0;
            background: rgba(255,51,51,0.03);
            border: 1px dashed #ffcccc;
            border-radius: 4px;
            margin: 2px;
        }
        .anti-hole-tip {
            position: absolute;
            top: 0;
            right: 4px;
            color: #fff;
            background: #28a745;
            font-size: 10px;
            font-weight: 600;
            padding: 1px 6px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(40,167,69,0.2);
            display: none;
        }
        .hole-container {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            width: 100%;
            white-space: nowrap;
        }
        .hole-label {
            color: #333;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 2px;
            white-space: nowrap;
        }
        .hole-label::before { content: "üü¢"; font-size: 8px; }
        .hole-number-group {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-left: auto;
            max-width: calc(100% - 30px);
            max-height: 48px;
            height: auto;
            align-content: center;
        }
        .hole-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 1px;
            padding: 1px 1.5px;
            border-radius: 2px;
            background: #f5f5f5;
            box-shadow: 0 1px 1px rgba(0,0,0,0.05), inset 0 1px 1px rgba(255,255,255,0.6);
            border: 1px solid #eee;
            width: 18px;
            height: 16px;
            text-align: center;
        }
        .hole-number { font-size: 9px; font-weight: 700; }
        .hole-blue { color: #0052cc; }
        .hole-green { color: #28a745; }
        .hole-red { color: #e02424; }
        .hole-count {
            font-size: 6px;
            color: #000;
            font-weight: 600;
            vertical-align: super;
            margin-left: 0.5px;
            background: rgba(0,0,0,0.05);
            padding: 0 0.5px;
            border-radius: 1px;
        }
        .history-section {
            padding: 6px 8px;
            border-radius: 8px;
            background: #fefefe;
            box-shadow: 0 2px 7px rgba(0,0,0,0.06);
            border: 1px solid #f0f0f0;
            position: relative;
            margin-top: 3px;
        }
        .history-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #0066ff 0%, #ff3333 100%);
            opacity: 0.6;
        }
        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            max-height: 70px;
            overflow-y: auto;
            font-size: 13px;
            padding: 3px 2px;
            background: #fafafa;
            border-radius: 4px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.02);
        }
        .history-item {
            padding: 3px 7px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), inset 0 1px 1px rgba(255,255,255,0.5);
            min-width: calc(12.5% - 2px);
            text-align: center;
            margin: 0 1px 3px;
        }
        .history-item.host-item {
            background: linear-gradient(145deg, rgba(0,102,255,0.1) 0%, rgba(0,86,210,0.1) 100%);
            color: #0066ff;
        }
        .history-item.guest-item {
            background: linear-gradient(145deg, rgba(255,51,51,0.1) 0%, rgba(230,46,46,0.1) 100%);
            color: #ff3333;
        }
        .num-big {
            font-size: 14px !important;
            font-weight: 600 !important;
            min-width: 18px;
            display: inline-block;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.05);
        }
        .delete-tip {
            font-size: 10px;
            color: #888;
            margin-left: 6px;
            font-weight: normal;
        }
        .admin-section {
            max-width: 500px;
            margin: 8px auto 0;
            padding: 6px 8px;
            border-radius: 8px;
            background: #fefefe;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #f0f0f0;
            display: none;
            position: relative;
        }
        .admin-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: #0066ff;
        }
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            padding: 3px 6px;
            border-bottom: 1px solid #f0f0f0;
            border-radius: 4px;
            background: linear-gradient(180deg, #f9f9f9 0%, #f5f5f5 100%);
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.8), 0 1px 1px rgba(0,0,0,0.03);
        }
        .admin-header h3 {
            font-size: 13px;
            color: #333;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .admin-form { display: flex; gap: 8px; margin-top: 4px; }
        .admin-input {
            flex: 1;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            outline: none;
            background: #fafafa;
        }
        .save-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            background: linear-gradient(135deg, #0066ff 0%, #0056d2 100%);
            color: #fff;
            font-size: 12px;
            cursor: pointer;
        }
        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 2px;
            box-shadow: inset 0 0 2px rgba(0,0,0,0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ccc 0%, #bbb 100%);
            border-radius: 3px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.12);
        }
        *:has(.num-grid) {
            overflow: visible !important;
            clip: auto !important;
            height: auto !important;
        }
    </style>
</head>
<body>
    <div class="pwd-modal" id="pwdModal">
        <div class="pwd-modal-content">
            <h3>ËØ∑ËæìÂÖ•ËÆøÈóÆÂØÜÁ†Å</h3>
            <input type="password" class="pwd-input" id="pwdInput" placeholder="ËæìÂÖ•ÂØÜÁ†Å">
            <div class="pwd-btn-group">
                <button class="pwd-btn pwd-confirm" onclick="verifyPwd()">Á°ÆËÆ§</button>
                <button class="pwd-btn pwd-cancel" onclick="hidePwdModal()">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>
    <div class="container-outer">
        <div class="password-error" id="passwordError">
            ÊèêÁ§∫ÔºöËØ∑ËæìÂÖ•Ê≠£Á°ÆÂØÜÁ†Å„ÄÇ<br>
            <button onclick="showPwdModal()">ÈáçÊñ∞ËæìÂÖ•</button>
        </div>
        <div class="container" id="appContainer">
            <div class="input-wrapper">
                <div class="quick-input">
                    <div class="input-header host-header">‰∏ªÈòü</div>
                    <div class="num-grid host-grid" id="hostGrid"></div>
                </div>
                <div class="quick-input">
                    <div class="input-header guest-header">ÂÆ¢Èòü</div>
                    <div class="num-grid guest-grid" id="guestGrid"></div>
                </div>
            </div>
            <div class="control-wrapper">
                <div class="arrow-group">
                    <button class="arrow-btn" onclick="scrollNums('host', -6)">‚Üë</button>
                    <button class="arrow-btn" onclick="setCenter('host', '-')">-</button>
                    <button class="arrow-btn" onclick="setCenter('host', '+')">+</button>
                    <button class="arrow-btn" onclick="scrollNums('host', 6)">‚Üì</button>
                </div>
                <button class="reset-btn" onclick="resetPos()">‚ü≤</button>
                <div class="arrow-group">
                    <button class="arrow-btn" onclick="scrollNums('guest', -6)">‚Üë</button>
                    <button class="arrow-btn" onclick="setCenter('guest', '-')">-</button>
                    <button class="arrow-btn" onclick="setCenter('guest', '+')">+</button>
                    <button class="arrow-btn" onclick="scrollNums('guest', 6)">‚Üì</button>
                </div>
            </div>
            <div class="match-section">
                <div class="section">
                    <div class="section-header">
                        <h3 id="sameDiskCount">ÂêåÁõò <span class="num-big">0</span> ÁªÑ</h3>
                        <button class="clear-btn" onclick="clearAll()">Ê∏ÖÈô§ÊâÄÊúâ</button>
                    </div>
                    <div class="display-section" id="sameDiskContainer">
                        <div class="empty-tip">ÊöÇÊó†ÂêåÁõòÂåπÈÖç</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">
                        <h3 id="matchCount">ÂØåË¥µÊ¥û <span class="num-big">0</span> ÁªÑ</h3>
                        <div id="holeContainer" class="hole-container">
                            <span class="hole-label">Ê¥ûÔºö</span>
                            <div class="hole-number-group" id="holeNumberGroup">
                                <div class="empty-tip">ÊöÇÊó†Êï∞ÊçÆ</div>
                            </div>
                        </div>
                    </div>
                    <div class="display-section" id="matchedContainer">
                        <div class="empty-tip">ÊöÇÊó†ÂØåË¥µÊ¥ûÂåπÈÖç</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">
                        <h3 id="unmatchCount">ÂøÖËÉúËæπÔºà‰∏ªÈòüËæπ<span class="num-big">0</span> ÂÆ¢ÈòüËæπ<span class="num-big">0</span>Ôºâ</h3>
                        <span class="title-text">ÁôΩÊó•ÊîæÊ≠åÂåπÈÖçÂô®</span>
                    </div>
                    <div class="unmatched-wrap">
                        <div class="unmatched-group">
                            <h4>‰∏ªÈòüÔºàËìùÔºâ</h4>
                            <div class="anti-hole-tip" id="antiHoleTip">ÂèçÊ¥û</div>
                            <div class="display-section" id="unmatchedHost">
                                <div class="empty-tip">ÊöÇÊó†</div>
                            </div>
                        </div>
                        <div class="unmatched-group">
                            <h4>ÂÆ¢ÈòüÔºàÁ∫¢Ôºâ</h4>
                            <div class="display-section" id="unmatchedGuest">
                                <div class="empty-tip">ÊöÇÊó†</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="history-section">
                <h3 id="inputCount">Â∑≤Ê≥®ÂÖ• <span class="num-big">0</span>Ôºà‰∏ª<span class="num-big">0</span> ÂÆ¢<span class="num-big">0</span>Ôºâ<span class="delete-tip">„ÄêÁÇπÂáªÂà†Èô§„Äë</span></h3>
                <div class="history-list" id="historyList">
                    <div class="empty-tip">ÊöÇÊó†</div>
                </div>
            </div>
        </div>
        <div class="admin-section" id="adminSection">
            <div class="admin-header">
                <h3>üîß Á≥ªÁªüÁÆ°ÁêÜÔºàÁÆ°ÁêÜÂëòÊùÉÈôêÔºâ</h3>
            </div>
            <div class="admin-form">
                <input type="text" class="admin-input" id="newPwd" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÁöÑÊôÆÈÄöËÆøÈóÆÂØÜÁ†ÅÔºàÂΩìÂâçÔºö168168Ôºâ">
                <button class="save-btn" onclick="savePwd()">‰øùÂ≠ò‰øÆÊîπ</button>
            </div>
        </div>
    </div>
    <script>
        const CONFIG = {
            ADMIN_PWD: "18181818",
            INIT_PWD: "168168",
            MIN_NUM: -120.5,
            MAX_NUM: 120.5,
            NUM_COUNT: 18,
            ACTIVE_IDX: 8,
            STEP: 15
        };
        let state = {
            hostMiddle: 0.5,
            inputOrder: [],
            accessPwd: localStorage.getItem('daytimeMatchPwd') || CONFIG.INIT_PWD,
            isAdmin: false,
            dir: { host: 'reset', guest: 'reset' },
            step: { host: 0, guest: 0 }
        };
        window.onload = showPwdModal;

        function showPwdModal() {
            getEl('pwdModal').style.display = 'flex';
            getEl('pwdInput').value = '';
        }

        function hidePwdModal() {
            getEl('pwdModal').style.display = 'none';
        }

        function verifyPwd() {
            const pwd = getEl('pwdInput').value.trim();
            hidePwdModal();
            if (pwd === CONFIG.ADMIN_PWD) {
                state.isAdmin = true;
                showEl(['appContainer', 'adminSection']);
                getEl('newPwd').placeholder = `ËØ∑ËæìÂÖ•Êñ∞ÁöÑÊôÆÈÄöËÆøÈóÆÂØÜÁ†ÅÔºàÂΩìÂâçÔºö${state.accessPwd}Ôºâ`;
                alert("ÁÆ°ÁêÜÂëòÁôªÂΩïÊàêÂäü");
            } else if (pwd === state.accessPwd) showEl(['appContainer']);
            else showEl(['passwordError']);
            initApp();
        }

        function savePwd() {
            if (!state.isAdmin) return alert("Êó†ÁÆ°ÁêÜÂëòÊùÉÈôê");
            const newPwd = getEl('newPwd').value.trim();
            if (!newPwd) return alert("ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫");
            if (newPwd.length < 6) alert("Âª∫ËÆÆÂØÜÁ†Å‚â•6‰Ωç");
            state.accessPwd = newPwd;
            localStorage.setItem('daytimeMatchPwd', newPwd);
            getEl('newPwd').placeholder = `ËØ∑ËæìÂÖ•Êñ∞ÁöÑÊôÆÈÄöËÆøÈóÆÂØÜÁ†ÅÔºàÂΩìÂâçÔºö${newPwd}Ôºâ`;
            getEl('newPwd').value = "";
            alert(`ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºö${newPwd}`);
        }

        function initApp() {
            updateGrids();
            updateInputCount();
        }

        function updateGrids() {
            const [hostDom, guestDom] = [getEl('hostGrid'), getEl('guestGrid')];
            hostDom.innerHTML = guestDom.innerHTML = "";
            const start = state.hostMiddle - 8;
            for (let i = 0; i < CONFIG.NUM_COUNT; i++) {
                const num = start + i;
                const clampedNum = Math.max(CONFIG.MIN_NUM, Math.min(CONFIG.MAX_NUM, num));
                hostDom.appendChild(createNumItem(clampedNum, 'host', i === CONFIG.ACTIVE_IDX));
                guestDom.appendChild(createNumItem(-clampedNum, 'guest', i === CONFIG.ACTIVE_IDX));
            }
        }

        function createNumItem(num, type, isActive) {
            const item = document.createElement('div');
            let display = num === -0.5 ? '-0' : num === 0.5 ? '+0' : (num > 0 ? `+${Math.floor(num)}` : Math.ceil(num));
            item.className = `num-item ${isActive ? 'active' : ''}`;
            item.textContent = display;
            item.onclick = () => {
                state.inputOrder.push({
                    id: Date.now() + Math.random(),
                    type,
                    value: num,
                    display,
                    isNegative: num < 0,
                    signNum: Math.abs(num > 0 ? Math.floor(num) : Math.ceil(num))
                });
                updateHistory();
                updateInputCount();
                rematch();
                getEl('historyList').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            };
            return item;
        }

        function scrollNums(type, step) {
            let newMiddle = state.hostMiddle;
            newMiddle = type === 'guest' ? -(-newMiddle + step) : newMiddle + step;
            newMiddle = Math.max(CONFIG.MIN_NUM, Math.min(CONFIG.MAX_NUM, newMiddle));
            state.hostMiddle = newMiddle;
            updateGrids();
        }

        function resetPos() {
            state.hostMiddle = 0.5;
            state.dir = { host: 'reset', guest: 'reset' };
            state.step = { host: 0, guest: 0 };
            updateGrids();
        }

        function setCenter(type, dir) {
            let newStep = state.step[type];
            if (state.dir[type] !== dir) {
                newStep = dir === '+' ? 1 : -1;
            } else {
                newStep = dir === '+' ? newStep + 1 : newStep - 1;
            }
            let offset = newStep * CONFIG.STEP;
            offset = Math.max(-120, Math.min(120, offset));
            state.step[type] = offset / CONFIG.STEP;
            state.dir[type] = dir;
            state.hostMiddle = type === 'guest' ? -offset : offset;
            state.hostMiddle = Math.max(CONFIG.MIN_NUM, Math.min(CONFIG.MAX_NUM, state.hostMiddle));
            updateGrids();
        }

        function updateHistory() {
            const dom = getEl('historyList');
            if (!state.inputOrder.length) return dom.innerHTML = '<div class="empty-tip">ÊöÇÊó†</div>';
            dom.innerHTML = "";
            state.inputOrder.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = `history-item ${item.type}-item`;
                el.textContent = item.display;
                el.onclick = () => {
                    state.inputOrder.splice(idx, 1);
                    updateHistory();
                    updateInputCount();
                    rematch();
                };
                dom.appendChild(el);
            });
            dom.scrollTop = dom.scrollHeight;
        }

        function rematch() {
            const [hosts, guests] = [
                state.inputOrder.filter(i => i.type === 'host'),
                state.inputOrder.filter(i => i.type === 'guest')
            ];
            const [sameDisk, normal] = [[], []];
            const usedGuest = new Set();
            const sortedHost = [...hosts].sort((a, b) => a.value - b.value);
            const sortedGuest = [...guests].sort((a, b) => a.value - b.value);

            sortedHost.forEach(host => {
                for (const guest of sortedGuest) {
                    if (usedGuest.has(guest.id) || (host.isNegative && guest.isNegative)) continue;
                    const opposite = host.isNegative !== guest.isNegative;
                    const sameNum = host.signNum === guest.signNum;
                    if (opposite && sameNum) {
                        sameDisk.push({ hostId: host.id, guestId: guest.id });
                        usedGuest.add(guest.id);
                        break;
                    } else if ((opposite && !sameNum && (host.isNegative ? guest.signNum : host.signNum) > (host.isNegative ? host.signNum : guest.signNum)) || (!opposite && !host.isNegative)) {
                        normal.push({ hostId: host.id, guestId: guest.id });
                        usedGuest.add(guest.id);
                        break;
                    }
                }
            });

            const sortedNormal = [...normal].sort((a, b) => {
                const ha = getById(a.hostId), hb = getById(b.hostId);
                return hb.value - ha.value;
            });
            const usedHostIds = [...sameDisk, ...normal].map(p => p.hostId);
            const unmatchedHost = hosts.filter(h => !usedHostIds.includes(h.id)).sort((a, b) => b.value - a.value);
            const unmatchedGuest = guests.filter(g => !usedGuest.has(g.id)).sort((a, b) => b.value - a.value);
            const holeData = calcHole(sortedNormal);

            const antiHoleTip = getEl('antiHoleTip');
            antiHoleTip.style.display = (unmatchedHost.length >= 2 && unmatchedGuest.length >= 2) ? 'block' : 'none';

            updateMatchCount(sameDisk.length, normal.length, unmatchedHost.length, unmatchedGuest.length);
            updateMatchDisplay(sameDisk, 'sameDiskContainer', 'same-disk-item');
            updateMatchDisplay(sortedNormal, 'matchedContainer', 'matched-item');
            updateUnmatchDisplay(unmatchedHost, unmatchedGuest);
            updateHoleDisplay(holeData);
        }

        function calcHole(pairs) {
            const hole = [];
            pairs.forEach(p => {
                const [host, guest] = [getById(p.hostId), getById(p.guestId)];
                const [hAbs, gAbs] = [host.signNum, guest.signNum];
                if (!host.isNegative && !guest.isNegative) {
                    for (let i = gAbs; i >= 1; i--) hole.push({ c: 'blue', v: i });
                    hole.push({ c: 'green', v: 0 });
                    for (let i = 1; i <= hAbs; i++) hole.push({ c: 'red', v: i });
                } else if (host.isNegative && !guest.isNegative) {
                    for (let i = gAbs; i >= hAbs + 1; i--) hole.push({ c: 'blue', v: i });
                } else if (!host.isNegative && guest.isNegative) {
                    for (let i = gAbs + 1; i <= hAbs; i++) hole.push({ c: 'red', v: i });
                }
            });

            const count = {};
            hole.forEach(item => {
                const key = `${item.c}-${item.v}`;
                count[key] = (count[key] || 0) + 1;
            });

            return Object.keys(count).map(key => {
                const [c, v] = key.split('-');
                return { color: c, value: +v, count: count[key] };
            }).sort((a, b) => {
                const colorOrder = { blue: 1, green: 2, red: 3 };
                return a.color !== b.color ? colorOrder[a.color] - colorOrder[b.color] : (a.color === 'blue' ? b.value - a.value : a.value - b.value);
            });
        }

        function updateHoleDisplay(data) {
            const group = getEl('holeNumberGroup');
            group.innerHTML = "";
            const totalInput = state.inputOrder.length;

            if (totalInput > 10 && data.length === 0) {
                group.innerHTML = '<div class="overflow-tip">Ê¨∏ÔºåÊ¨∏ÔºåÊ¨∏ÔºüÊàëÊ¥ûÂë¢ÔºüÔºü</div>';
                return;
            }
            if (data.length > 24) {
                group.innerHTML = '<div class="overflow-tip">Ëøô‰πàÂ§öÔºåÂ∫ÑÈ∫ª‰∫ÜÔºåÈÉΩÊòØ‰Ω†ÁöÑ‰∫ÜÔºÅÔºÅ</div>';
                return;
            }
            if (data.length === 0) {
                group.innerHTML = '<div class="empty-tip">ÊöÇÊó†Êï∞ÊçÆ</div>';
                return;
            }

            const rowHeight = 16;
            group.style.height = data.length <= 8 ? `${rowHeight}px` : data.length <= 16 ? `${rowHeight * 2}px` : `${rowHeight * 3}px`;
            data.forEach(item => {
                const el = document.createElement('span');
                el.className = 'hole-item';
                el.innerHTML = `<span class="hole-number hole-${item.color}">${item.value}</span>${item.count > 1 ? `<span class="hole-count">${item.count}</span>` : ''}`;
                group.appendChild(el);
            });
        }

        function updateMatchDisplay(pairs, containerId, cls) {
            const dom = getEl(containerId);
            dom.innerHTML = "";
            if (!pairs.length) {
                dom.innerHTML = `<div class="empty-tip">ÊöÇÊó†${containerId === 'sameDiskContainer' ? 'ÂêåÁõò' : 'ÂØåË¥µÊ¥û'}ÂåπÈÖç</div>`;
                return;
            }
            pairs.forEach(p => {
                const [host, guest] = [getById(p.hostId), getById(p.guestId)];
                const el = document.createElement('div');
                el.className = cls;
                el.innerHTML = `„Äê<span class="host-value">${host.display}</span>‚Üî<span class="guest-value">${guest.display}</span>„Äë`;
                dom.appendChild(el);
            });
            dom.scrollTop = dom.scrollHeight;
        }

        function updateUnmatchDisplay(hosts, guests) {
            const [hDom, gDom] = [getEl('unmatchedHost'), getEl('unmatchedGuest')];
            hDom.innerHTML = hosts.length === 0 ? '<div class="empty-tip">ÊöÇÊó†</div>' : hosts.map(h => `<div class="unmatched-item"><span class="host-value">${h.display}</span></div>`).join('');
            gDom.innerHTML = guests.length === 0 ? '<div class="empty-tip">ÊöÇÊó†</div>' : guests.map(g => `<div class="unmatched-item"><span class="guest-value">${g.display}</span></div>`).join('');
            
            hDom.scrollTop = hDom.scrollHeight;
            gDom.scrollTop = gDom.scrollHeight;
        }

        function updateMatchCount(same, normal, unHost, unGuest) {
            getEl('sameDiskCount').innerHTML = `ÂêåÁõò <span class="num-big">${same}</span> ÁªÑ`;
            getEl('matchCount').innerHTML = `ÂØåË¥µÊ¥û <span class="num-big">${normal}</span> ÁªÑ`;
            getEl('unmatchCount').innerHTML = `ÂøÖËÉúËæπÔºà‰∏ªÈòüËæπ<span class="num-big">${unHost}</span> ÂÆ¢ÈòüËæπ<span class="num-big">${unGuest}</span>Ôºâ`;
        }

        function updateInputCount() {
            const total = state.inputOrder.length;
            const hostCount = state.inputOrder.filter(i => i.type === 'host').length;
            const guestCount = total - hostCount;
            getEl('inputCount').innerHTML = `Â∑≤Ê≥®ÂÖ• <span class="num-big">${total}</span>Ôºà‰∏ª<span class="num-big">${hostCount}</span> ÂÆ¢<span class="num-big">${guestCount}</span>Ôºâ<span class="delete-tip">„ÄêÁÇπÂáªÂà†Èô§„Äë</span>`;
        }

        function clearAll() {
            state.hostMiddle = 0.5;
            state.inputOrder = [];
            state.dir = { host: 'reset', guest: 'reset' };
            state.step = { host: 0, guest: 0 };
            getEl('antiHoleTip').style.display = 'none';
            updateGrids();
            updateHistory();
            updateInputCount();
            updateMatchCount(0, 0, 0, 0);
            updateMatchDisplay([], 'sameDiskContainer', 'same-disk-item');
            updateMatchDisplay([], 'matchedContainer', 'matched-item');
            updateUnmatchDisplay([], []);
            updateHoleDisplay([]);
        }

        function getEl(id) { return document.getElementById(id); }
        function showEl(ids) { ids.forEach(id => getEl(id).style.display = id === 'appContainer' ? 'flex' : 'block'); }
        function getById(id) { return state.inputOrder.find(i => i.id === id); }
    </script>
</body>
</html>
